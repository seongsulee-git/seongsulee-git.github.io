---
layout: post
title:  "Jacoco Setting in Spring Boot"
date:   2021-04-11 02:30:00 +0900
categories: SpringBoot Jacoco
order: 3
---

# Jacoco Setting Guide
프로젝트 간 Jacoco 세팅 가이드 정리
History
- 2021.04.11 - 기존 문서 이관 (세부 분석 내용 업데이트 예정)

### Build.gradle
- jacoco Plugin 추가

    ``` gradle
    plugins{
        id 'org.springframework.boot' version '2.2.5.RELEASE'
        id 'io.spring.dependency-management' version '1.0.9.RELEASE'
        id 'java'
        id 'jacoco'
    }
    ```
- jacoco 버전 설정
    ``` gradle
    jacoco{
        toolVersion = "0.8.5"
    }
    ```

- jacoco TestReport 옵션 설정 (테스트 결과에 대한 양식 설정)
    ``` gradle
    jacocoTestReport {
        reports {
            html.enabled(true)
            xml.enabled(true)
        }
    }
    ```

- jacoco TestCoverageVerification 옵션 설정 ()
    ``` gradle
    jacocoTestCoverageVerification {
        violationRules {
            rule {
                element = 'CLASS'
                limit {
                    counter = 'BRANCH'
                    value = 'COVEREDRATIO'
                    minimum = 0.0           // 해당 퍼센테이지 통과 못할시 Test 통과 못함
                }
            }
        }
    }
    ```

- Coverage Task 생성 및 실행 순서 설정
    ``` gradle
    task coverageTask(type: Test) {
        group 'verification'
        description 'Runs the unit tests with coverage'

        jacoco {
            enabled = true
            destinationFile = file("$buildDir/jacoco/${name}.exec")
            included = []
            excluded = ['*.*Controller']
            excludeClassLoaders = []
            includeNoLocationClasses = false
            sessionId = "<auto-generated value>"
            dumpOnExit = true
            classDumpDir = null
            output = JacocoTaskExtension.Output.FILE
            address = "localhost"
            port = 6300
            jmx = false
        }

        dependsOn(
            ':test',
            ':jacocoTestReport',
            ':jacocoTestCoverageVerification'
        )

        tasks['jacocoTestReport'].mustRunAfter(tasks['test'])
        tasks['jacocoTestCoverageVerification'].mustRunAfter(tasks['jacocoTestReport'])
    }
    build.finalizedBy(coverageTask)
    ```

### lombok.config
- Lombok 관련 내용을 Code Coverage에 포함되도록 설정
    ``` config
    lombok.addLombokGeneratedAnnotation = true
    ```

### Local Jacoco 결과 확인방법
1. Terminal에 명령어 입력 : gradle clean build --console verbose coverageTask
2. coverageTask > jacoco > destinationFile 설정값의 위치에서 확인 가능